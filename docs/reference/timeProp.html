<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Time series plot with categories shown as a stacked bar chart — timeProp • openair</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Time series plot with categories shown as a stacked bar chart — timeProp" />
<meta property="og:description" content="This function shows time series plots as stacked bar charts. The
different categories in the bar chart are made up from a character
or factor variable in a data frame. The function is primarily
developed to support the plotting of cluster analysis output from
polarCluster and trajCluster that
consider local and regional (back trajectory) cluster analysis
respectively. However, the function has more general use for
understanding time series data." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">openair</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.8-6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/davidcarslaw/openair">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Time series plot with categories shown as a stacked bar chart</h1>
    <small class="dont-index">Source: <a href='https://github.com/davidcarslaw/openair/blob/master/R/timeProp.R'><code>R/timeProp.R</code></a></small>
    <div class="hidden name"><code>timeProp.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function shows time series plots as stacked bar charts. The
different categories in the bar chart are made up from a character
or factor variable in a data frame. The function is primarily
developed to support the plotting of cluster analysis output from
<code><a href='polarCluster.html'>polarCluster</a></code> and <code><a href='trajCluster.html'>trajCluster</a></code> that
consider local and regional (back trajectory) cluster analysis
respectively. However, the function has more general use for
understanding time series data.</p>
    </div>

    <pre class="usage"><span class='fu'>timeProp</span><span class='op'>(</span>
  <span class='va'>mydata</span>,
  pollutant <span class='op'>=</span> <span class='st'>"nox"</span>,
  proportion <span class='op'>=</span> <span class='st'>"cluster"</span>,
  avg.time <span class='op'>=</span> <span class='st'>"day"</span>,
  type <span class='op'>=</span> <span class='st'>"default"</span>,
  statistic <span class='op'>=</span> <span class='st'>"mean"</span>,
  normalise <span class='op'>=</span> <span class='cn'>FALSE</span>,
  cols <span class='op'>=</span> <span class='st'>"Set1"</span>,
  date.breaks <span class='op'>=</span> <span class='fl'>7</span>,
  date.format <span class='op'>=</span> <span class='cn'>NULL</span>,
  key.columns <span class='op'>=</span> <span class='fl'>1</span>,
  key.position <span class='op'>=</span> <span class='st'>"right"</span>,
  key.title <span class='op'>=</span> <span class='va'>proportion</span>,
  auto.text <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>mydata</th>
      <td><p>A data frame containing the fields <code>date</code>,
<code>pollutant</code> and a splitting variable <code>proportion</code></p></td>
    </tr>
    <tr>
      <th>pollutant</th>
      <td><p>Name of the pollutant to plot contained in
<code>mydata</code>.</p></td>
    </tr>
    <tr>
      <th>proportion</th>
      <td><p>The splitting variable that makes up the bars in
the bar chart e.g. <code>proportion = "cluster"</code> if the output
from <code>polarCluster</code> is being analysed. If <code>proportion</code>
is a numeric variable it is split into 4 quantiles (by default)
by <code>cutData</code>. If <code>proportion</code> is a factor or character
variable then the categories are used directly.</p></td>
    </tr>
    <tr>
      <th>avg.time</th>
      <td><p>This defines the time period to average to. Can be
  &#8220;sec&#8221;, &#8220;min&#8221;, &#8220;hour&#8221;, &#8220;day&#8221;,
  &#8220;DSTday&#8221;, &#8220;week&#8221;, &#8220;month&#8221;, &#8220;quarter&#8221;
  or &#8220;year&#8221;. For much increased flexibility a number can
  precede these options followed by a space. For example, a
  timeAverage of 2 months would be <code>period = "2 month"</code>. In
  addition, <code>avg.time</code> can equal &#8220;season&#8221;, in which
  case 3-month seasonal values are calculated with spring defined
  as March, April, May and so on.</p>
<p>Note that <code>avg.time</code> when used in <code>timeProp</code> should be
  greater than the time gap in the original data. For example,
  <code>avg.time = "day"</code> for hourly data is OK, but
  <code>avg.time = "hour"</code> for daily data is not.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p><code>type</code> determines how the data are split i.e.
  conditioned, and then plotted. The default is will produce a
  single plot using the entire data. Type can be one of the
  built-in types as detailed in <code>cutData</code> e.g. "season",
  "year", "weekday" and so on. For example, <code>type = "season"</code>
  will produce four plots --- one for each season.</p>
<p>It is also possible to choose <code>type</code> as another variable in
  the data frame. If that variable is numeric, then the data will
  be split into four quantiles (if possible) and labelled
  accordingly. If type is an existing character or factor
  variable, then those categories/levels will be used directly.
  This offers great flexibility for understanding the variation of
  different variables and how they depend on one another.</p>
<p><code>type</code> must be of length one.</p></td>
    </tr>
    <tr>
      <th>statistic</th>
      <td><p>Determines how the bars are calculated. The
default (&#8220;mean&#8221;) will provide the contribution to the
overall mean for a time interval. <code>statistic = "frequency"</code>
will give the proportion in terms of counts.</p></td>
    </tr>
    <tr>
      <th>normalise</th>
      <td><p>If <code>normalise = TRUE</code> then each time
interval is scaled to 100. This is helpful to show the relative
(percentage) contribution of the proportions.</p></td>
    </tr>
    <tr>
      <th>cols</th>
      <td><p>Colours to be used for plotting. Options include
&#8220;default&#8221;, &#8220;increment&#8221;, &#8220;heat&#8221;,
&#8220;jet&#8221; and <code>RColorBrewer</code> colours --- see the
<code>openair</code> <code>openColours</code> function for more details. For
user defined the user can supply a list of colour names
recognised by R (type <code><a href='https://rdrr.io/r/grDevices/colors.html'>colours()</a></code> to see the full list). An
example would be <code>cols = c("yellow", "green", "blue")</code></p></td>
    </tr>
    <tr>
      <th>date.breaks</th>
      <td><p>Number of major x-axis intervals to use. The
function will try and choose a sensible number of dates/times as
well as formatting the date/time appropriately to the range
being considered.  This does not always work as desired
automatically. The user can therefore increase or decrease the
number of intervals by adjusting the value of <code>date.breaks</code>
up or down.</p></td>
    </tr>
    <tr>
      <th>date.format</th>
      <td><p>This option controls the date format on the
x-axis. While <code>timePlot</code> generally sets the date format
sensibly there can be some situations where the user wishes to
have more control. For format types see <code>strptime</code>. For
example, to format the date like &#8220;Jan-2012&#8221; set
<code>date.format = "%b-%Y"</code>.</p></td>
    </tr>
    <tr>
      <th>key.columns</th>
      <td><p>Number of columns to be used in the key. With
many pollutants a single column can make to key too wide. The
user can thus choose to use several columns by setting
<code>columns</code> to be less than the number of pollutants.</p></td>
    </tr>
    <tr>
      <th>key.position</th>
      <td><p>Location where the scale key is to plotted.
Allowed arguments currently include &#8220;top&#8221;,
&#8220;right&#8221;, &#8220;bottom&#8221; and &#8220;left&#8221;.</p></td>
    </tr>
    <tr>
      <th>key.title</th>
      <td><p>The title of the key.</p></td>
    </tr>
    <tr>
      <th>auto.text</th>
      <td><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If
<code>TRUE</code> titles and axis labels etc. will automatically try
and format pollutant names and units properly e.g.  by
subscripting the `2' in NO2.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other graphical parameters passed onto <code>timeProp</code>
and <code>cutData</code>. For example, <code>timeProp</code> passes the
option <code>hemisphere = "southern"</code> on to <code>cutData</code> to
provide southern (rather than default northern) hemisphere
handling of <code>type = "season"</code>. Similarly, common axis and
title labelling options (such as <code>xlab</code>, <code>ylab</code>,
<code>main</code>) are passed to <code>xyplot</code> via <code>quickText</code> to
handle routine formatting.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>In order to plot time series in this way, some sort of time
aggregation is needed, which is controlled by the option
<code>avg.time</code>.</p>
<p>The plot shows the value of <code>pollutant</code> on the y-axis
(averaged according to <code>avg.time</code>). The time intervals are
made up of bars split according to <code>proportion</code>. The bars
therefore show how the total value of <code>pollutant</code> is made up
for any time interval.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>See <code><a href='timePlot.html'>timePlot</a></code> for time series plotting,
  <code><a href='polarCluster.html'>polarCluster</a></code> for cluster analysis of bivariate
  polar plots and <code><a href='trajCluster.html'>trajCluster</a></code> for cluster analysis
  of HYSPLIT back trajectories.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>David Carslaw</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='r-in'></span>
<span class='r-in'><span class='co'>## See manual for more examples e.g. related to clustering</span></span>
<span class='r-in'></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## monthly plot of SO2 showing the contribution by wind sector</span></span>
<span class='r-in'><span class='fu'>timeProp</span><span class='op'>(</span><span class='va'>mydata</span>, pollutant <span class='op'>=</span> <span class='st'>"so2"</span>, avg.time <span class='op'>=</span> <span class='st'>"month"</span>, proportion <span class='op'>=</span> <span class='st'>"wd"</span><span class='op'>)</span></span>
<span class='r-wrn co'><span class='r-pr'>#&gt;</span> <span class='warning'>Warning: </span>219 missing wind direction line(s) removed</span>
<span class='r-plt img'><img src='timeProp-1.png' alt='' width='700' height='433' /></span>
<span class='r-in'></span>
<span class='r-in'></span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Carslaw, Karl Ropkins.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


