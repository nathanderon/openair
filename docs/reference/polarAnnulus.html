<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Bivariate polarAnnulus plot — polarAnnulus • openair</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Bivariate polarAnnulus plot — polarAnnulus" />
<meta property="og:description" content="Typically plots the concentration of a pollutant by wind direction and as a
function of time as an annulus. The function is good for visualising how
concentrations of pollutants vary by wind direction and a time period e.g.
by month, day of week." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">openair</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.8-6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/davidcarslaw/openair">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Bivariate polarAnnulus plot</h1>
    <small class="dont-index">Source: <a href='https://github.com/davidcarslaw/openair/blob/master/R/polarAnnulus.R'><code>R/polarAnnulus.R</code></a></small>
    <div class="hidden name"><code>polarAnnulus.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Typically plots the concentration of a pollutant by wind direction and as a
function of time as an annulus. The function is good for visualising how
concentrations of pollutants vary by wind direction and a time period e.g.
by month, day of week.</p>
    </div>

    <pre class="usage"><span class='fu'>polarAnnulus</span><span class='op'>(</span>
  <span class='va'>mydata</span>,
  pollutant <span class='op'>=</span> <span class='st'>"nox"</span>,
  resolution <span class='op'>=</span> <span class='st'>"fine"</span>,
  local.tz <span class='op'>=</span> <span class='cn'>NULL</span>,
  period <span class='op'>=</span> <span class='st'>"hour"</span>,
  type <span class='op'>=</span> <span class='st'>"default"</span>,
  statistic <span class='op'>=</span> <span class='st'>"mean"</span>,
  percentile <span class='op'>=</span> <span class='cn'>NA</span>,
  limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>100</span><span class='op'>)</span>,
  cols <span class='op'>=</span> <span class='st'>"default"</span>,
  width <span class='op'>=</span> <span class='st'>"normal"</span>,
  min.bin <span class='op'>=</span> <span class='fl'>1</span>,
  exclude.missing <span class='op'>=</span> <span class='cn'>TRUE</span>,
  date.pad <span class='op'>=</span> <span class='cn'>FALSE</span>,
  force.positive <span class='op'>=</span> <span class='cn'>TRUE</span>,
  k <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>20</span>, <span class='fl'>10</span><span class='op'>)</span>,
  normalise <span class='op'>=</span> <span class='cn'>FALSE</span>,
  key.header <span class='op'>=</span> <span class='st'>""</span>,
  key.footer <span class='op'>=</span> <span class='va'>pollutant</span>,
  key.position <span class='op'>=</span> <span class='st'>"right"</span>,
  key <span class='op'>=</span> <span class='cn'>TRUE</span>,
  auto.text <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>mydata</th>
      <td><p>A data frame minimally containing <code>date</code>, <code>wd</code> and
a pollutant.</p></td>
    </tr>
    <tr>
      <th>pollutant</th>
      <td><p>Mandatory. A pollutant name corresponding to a
variable in a data frame should be supplied e.g. <code>pollutant =
"nox"</code>. There can also be more than one pollutant specified
e.g. <code>pollutant = c("nox", "no2")</code>. The main use of using two
or more pollutants is for model evaluation where two species would
be expected to have similar concentrations. This saves the user
stacking the data and it is possible to work with columns of data
directly. A typical use would be <code>pollutant = c("obs",
"mod")</code> to compare two columns &#8220;obs&#8221; (the observations) and
&#8220;mod&#8221; (modelled values).</p></td>
    </tr>
    <tr>
      <th>resolution</th>
      <td><p>Two plot resolutions can be set: &#8220;normal&#8221; and
&#8220;fine&#8221; (the default).</p></td>
    </tr>
    <tr>
      <th>local.tz</th>
      <td><p>Should the results be calculated in local time
that includes a treatment of daylight savings time (DST)? The
default is not to consider DST issues, provided the data were
imported without a DST offset. Emissions activity tends to occur
at local time e.g. rush hour is at 8 am every day. When the clocks
go forward in spring, the emissions are effectively released into
the atmosphere typically 1 hour earlier during the summertime
i.e. when DST applies. When plotting diurnal profiles, this has
the effect of &#8220;smearing-out&#8221; the concentrations. Sometimes,
a useful approach is to express time as local time. This
correction tends to produce better-defined diurnal profiles of
concentration (or other variables) and allows a better comparison
to be made with emissions/activity data. If set to <code>FALSE</code>
then GMT is used. Examples of usage include <code>local.tz =
"Europe/London"</code>, <code>local.tz = "America/New_York"</code>. See
<code>cutData</code> and <code>import</code> for more details.</p></td>
    </tr>
    <tr>
      <th>period</th>
      <td><p>This determines the temporal period to
consider. Options are &#8220;hour&#8221; (the default, to plot diurnal
variations), &#8220;season&#8221; to plot variation throughout the
year, &#8220;weekday&#8221; to plot day of the week variation and
&#8220;trend&#8221; to plot the trend by wind direction.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p><code>type</code> determines how the data are split
i.e. conditioned, and then plotted. The default is will produce a
single plot using the entire data. Type can be one of the built-in
types as detailed in <code>cutData</code> e.g. &#8220;season&#8221;,
&#8220;year&#8221;, &#8220;weekday&#8221; and so on. For example, <code>type
= "season"</code> will produce four plots --- one for each season.</p>
<p>It is also possible to choose <code>type</code> as another variable in
the data frame. If that variable is numeric, then the data will be
split into four quantiles (if possible) and labelled
accordingly. If type is an existing character or factor variable,
then those categories/levels will be used directly. This offers
great flexibility for understanding the variation of different
variables and how they depend on one another.</p>
<p>Type can be up length two e.g. <code>type = c("season", "site")</code> will
  produce a 2x2 plot split by season and site. The use of two types is
  mostly meant for situations where there are several sites. Note, when two
  types are provided the first forms the columns and the second the rows.</p>
<p>Also note that for the <code>polarAnnulus</code> function some type/period
  combinations are forbidden or make little sense. For example, <code>type
  = "season"</code> and <code>period = "trend"</code> (which would result in a plot
  with too many gaps in it for sensible smoothing), or <code>type =
  "weekday"</code> and <code>period = "weekday"</code>.</p></td>
    </tr>
    <tr>
      <th>statistic</th>
      <td><p>The statistic that should be applied to each wind
speed/direction bin. Can be &#8220;mean&#8221; (default),
&#8220;median&#8221;, &#8220;max&#8221; (maximum),
&#8220;frequency&#8221;. &#8220;stdev&#8221; (standard deviation),
&#8220;weighted.mean&#8221; or &#8220;cpf&#8221; (Conditional Probability
Function). Because of the smoothing involved, the colour scale for
some of these statistics is only to provide an indication of
overall pattern and should not be interpreted in concentration
units e.g. for <code>statistic = "weighted.mean"</code> where the bin
mean is multiplied by the bin frequency and divided by the total
frequency. In many cases using <code>polarFreq</code> will be
better. Setting <code>statistic = "weighted.mean"</code> can be useful
because it provides an indication of the concentration * frequency
of occurrence and will highlight the wind speed/direction
conditions that dominate the overall mean.</p></td>
    </tr>
    <tr>
      <th>percentile</th>
      <td><p>If <code>statistic = "percentile"</code> or
<code>statistic = "cpf"</code> then <code>percentile</code> is used, expressed
from 0 to 100. Note that the percentile value is calculated in the
wind speed, wind direction &#8216;bins&#8217;. For this reason it can
also be useful to set <code>min.bin</code> to ensure there are a
sufficient number of points available to estimate a
percentile. See <code>quantile</code> for more details of how
percentiles are calculated.</p></td>
    </tr>
    <tr>
      <th>limits</th>
      <td><p>Limits for colour scale.</p></td>
    </tr>
    <tr>
      <th>cols</th>
      <td><p>Colours to be used for plotting. Options include
&#8220;default&#8221;, &#8220;increment&#8221;, &#8220;heat&#8221;, &#8220;jet&#8221;
and user defined. For user defined the user can supply a list of
colour names recognised by R (type <code><a href='https://rdrr.io/r/grDevices/colors.html'>colours()</a></code> to see the
full list). An example would be <code>cols = c("yellow", "green",
"blue")</code></p></td>
    </tr>
    <tr>
      <th>width</th>
      <td><p>The width of the annulus; can be &#8220;normal&#8221; (the
default), &#8220;thin&#8221; or &#8220;fat&#8221;.</p></td>
    </tr>
    <tr>
      <th>min.bin</th>
      <td><p>The minimum number of points allowed in a wind speed/wind
direction bin.  The default is 1. A value of two requires at least 2
valid records in each bin an so on; bins with less than 2 valid records
are set to NA. Care should be taken when using a value &gt; 1 because of the
risk of removing real data points. It is recommended to consider your
data with care. Also, the <code>polarFreq</code> function can be of use in such
circumstances.</p></td>
    </tr>
    <tr>
      <th>exclude.missing</th>
      <td><p>Setting this option to <code>TRUE</code> (the default)
removes points from the plot that are too far from the original data. The
smoothing routines will produce predictions at points where no data exist
i.e. they predict. By removing the points too far from the original data
produces a plot where it is clear where the original data lie. If set to
<code>FALSE</code> missing data will be interpolated.</p></td>
    </tr>
    <tr>
      <th>date.pad</th>
      <td><p>For <code>type = "trend"</code> (default), <code>date.pad = TRUE</code>
will pad-out missing data to the beginning of the first year and the end
of the last year. The purpose is to ensure that the trend plot begins and
ends at the beginning or end of year.</p></td>
    </tr>
    <tr>
      <th>force.positive</th>
      <td><p>The default is <code>TRUE</code>. Sometimes if smoothing
data with steep gradients it is possible for predicted values to be
negative. <code>force.positive = TRUE</code> ensures that predictions remain
postive. This is useful for several reasons. First, with lots of missing
data more interpolation is needed and this can result in artifacts
because the predictions are too far from the original data. Second, if it
is known beforehand that the data are all postive, then this option
carries that assumption through to the prediction. The only likely time
where setting <code>force.positive = FALSE</code> would be if background
concentrations were first subtracted resulting in data that is
legitimately negative. For the vast majority of situations it is expected
that the user will not need to alter the default option.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>The smoothing value supplied to <code>gam</code> for the temporal and
wind direction components, respectively. In some cases e.g. a trend plot
with less than 1-year of data the smoothing with the default values may
become too noisy and affected more by outliers. Choosing a lower value of
<code>k</code> (say 10) may help produce a better plot.</p></td>
    </tr>
    <tr>
      <th>normalise</th>
      <td><p>If <code>TRUE</code> concentrations are normalised by dividing
by their mean value. This is done <em>after</em> fitting the smooth
surface. This option is particularly useful if one is interested in the
patterns of concentrations for several pollutants on different scales
e.g. NOx and CO. Often useful if more than one <code>pollutant</code> is
chosen.</p></td>
    </tr>
    <tr>
      <th>key.header</th>
      <td><p>Adds additional text/labels to the scale key.
For example, passing the options <code>key.header = "header", key.footer
= "footer1"</code> adds addition text above and below the scale key. These
arguments are passed to <code>drawOpenKey</code> via <code>quickText</code>, applying
the <code>auto.text</code> argument, to handle formatting.</p></td>
    </tr>
    <tr>
      <th>key.footer</th>
      <td><p>see <code>key.header</code>.</p></td>
    </tr>
    <tr>
      <th>key.position</th>
      <td><p>Location where the scale key is to plotted.
Allowed arguments currently include &#8220;top&#8221;, &#8220;right&#8221;,
&#8220;bottom&#8221; and &#8220;left&#8221;.</p></td>
    </tr>
    <tr>
      <th>key</th>
      <td><p>Fine control of the scale key via <code>drawOpenKey</code>. See
<code>drawOpenKey</code> for further details.</p></td>
    </tr>
    <tr>
      <th>auto.text</th>
      <td><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If
<code>TRUE</code> titles and axis labels will automatically try and format
pollutant names and units properly e.g.  by subscripting the &#8216;2&#8217;
in NO2.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other graphical parameters passed onto <code>lattice:levelplot</code>
and <code>cutData</code>. For example, <code>polarAnnulus</code> passes the option
<code>hemisphere = "southern"</code> on to <code>cutData</code> to provide southern
(rather than default northern) hemisphere handling of <code>type = "season"</code>.
Similarly, common axis and title labelling options (such as <code>xlab</code>,
<code>ylab</code>, <code>main</code>) are passed to <code>levelplot</code> via <code>quickText</code>
to handle routine formatting.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>As well as generating the plot itself, <code>polarAnnulus</code> also
  returns an object of class ``openair''. The object includes three main
  components: <code>call</code>, the command used to generate the plot;
  <code>data</code>, the data frame of summarised information used to make the
  plot; and <code>plot</code>, the plot itself. If retained, e.g. using
  <code>output &lt;- polarAnnulus(mydata, "nox")</code>, this output can be used to
  recover the data, reproduce or rework the original plot or undertake
  further analysis.</p>
<p>An openair output can be manipulated using a number of generic operations,
  including <code>print</code>, <code>plot</code> and <code>summary</code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The <code>polarAnnulus</code> function shares many of the properties of the
<code>polarPlot</code>. However, <code>polarAnnulus</code> is focussed on displaying
information on how concentrations of a pollutant (values of another
variable) vary with wind direction and time. Plotting as an annulus helps
to reduce compression of information towards the centre of the plot. The
circular plot is easy to interpret because wind direction is most easily
understood in polar rather than Cartesian coordinates.</p>
<p>The inner part of the annulus represents the earliest time and the outer
part of the annulus the latest time. The time dimension can be shown in
many ways including "trend", "hour" (hour or day), "season" (month of the
year) and "weekday" (day of the week). Taking hour as an example, the plot
will show how concentrations vary by hour of the day and wind direction.
Such plots can be very useful for understanding how different source
influences affect a location.</p>
<p>For <code>type = "trend"</code> the amount of smoothing does not vary linearly
with the length of the time series i.e. a certain amount of smoothing per
unit interval in time. This is a deliberate choice because should one be
interested in a subset (in time) of data, more detail will be provided for
the subset compared with the full data set. This allows users to
investigate specific periods in more detail. Full flexibility is given
through the smoothing parameter <code>k</code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='polarPlot.html'>polarPlot</a></code>, <code><a href='polarFreq.html'>polarFreq</a></code>,
  <code><a href='windRose.html'>pollutionRose</a></code> and <code><a href='percentileRose.html'>percentileRose</a></code></p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>David Carslaw</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='r-in'></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># load example data from package</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>mydata</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># diurnal plot for PM10 at Marylebone Rd</span></span>
<span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='fu'>polarAnnulus</span><span class='op'>(</span><span class='va'>mydata</span>, pollutant <span class='op'>=</span> <span class='st'>"pm10"</span>,</span>
<span class='r-in'>main <span class='op'>=</span> <span class='st'>"diurnal variation in pm10 at Marylebone Road"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># seasonal plot for PM10 at Marylebone Rd</span></span>
<span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='fu'>polarAnnulus</span><span class='op'>(</span><span class='va'>mydata</span>, poll<span class='op'>=</span><span class='st'>"pm10"</span>, period <span class='op'>=</span> <span class='st'>"season"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># trend in coarse particles (PMc = PM10 - PM2.5), calculate PMc first</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>mydata</span><span class='op'>$</span><span class='va'>pmc</span> <span class='op'>&lt;-</span> <span class='va'>mydata</span><span class='op'>$</span><span class='va'>pm10</span> <span class='op'>-</span> <span class='va'>mydata</span><span class='op'>$</span><span class='va'>pm25</span></span>
<span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='fu'>polarAnnulus</span><span class='op'>(</span><span class='va'>mydata</span>, poll<span class='op'>=</span><span class='st'>"pmc"</span>, period <span class='op'>=</span> <span class='st'>"trend"</span>,</span>
<span class='r-in'>main <span class='op'>=</span> <span class='st'>"trend in pmc at Marylebone Road"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'></span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Carslaw, Karl Ropkins.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


