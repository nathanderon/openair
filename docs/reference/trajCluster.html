<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate clusters for back tracectories — trajCluster • openair</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calculate clusters for back tracectories — trajCluster" />
<meta property="og:description" content="This function carries out cluster analysis of HYSPLIT back
trajectories. The function is specifically designed to work with
the trajectories imported using the openair
importTraj function, which provides pre-calculated back
trajectories at specific receptor locations." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">openair</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.8-6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/davidcarslaw/openair">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate clusters for back tracectories</h1>
    <small class="dont-index">Source: <a href='https://github.com/davidcarslaw/openair/blob/master/R/trajCluster.R'><code>R/trajCluster.R</code></a></small>
    <div class="hidden name"><code>trajCluster.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function carries out cluster analysis of HYSPLIT back
trajectories. The function is specifically designed to work with
the trajectories imported using the <code>openair</code>
<code>importTraj</code> function, which provides pre-calculated back
trajectories at specific receptor locations.</p>
    </div>

    <pre class="usage"><span class='fu'>trajCluster</span><span class='op'>(</span>
  <span class='va'>traj</span>,
  method <span class='op'>=</span> <span class='st'>"Euclid"</span>,
  n.cluster <span class='op'>=</span> <span class='fl'>5</span>,
  plot <span class='op'>=</span> <span class='cn'>TRUE</span>,
  type <span class='op'>=</span> <span class='st'>"default"</span>,
  cols <span class='op'>=</span> <span class='st'>"Set1"</span>,
  split.after <span class='op'>=</span> <span class='cn'>FALSE</span>,
  map.fill <span class='op'>=</span> <span class='cn'>TRUE</span>,
  map.cols <span class='op'>=</span> <span class='st'>"grey40"</span>,
  map.alpha <span class='op'>=</span> <span class='fl'>0.4</span>,
  projection <span class='op'>=</span> <span class='st'>"lambert"</span>,
  parameters <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>51</span>, <span class='fl'>51</span><span class='op'>)</span>,
  orientation <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>90</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span>,
  by.type <span class='op'>=</span> <span class='cn'>FALSE</span>,
  origin <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>traj</th>
      <td><p>An openair trajectory data frame resulting from the
use of <code>importTraj</code>.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>Method used to calculate the distance matrix for the
back trajectories. There are two methods available:
&#8220;Euclid&#8221; and &#8220;Angle&#8221;.</p></td>
    </tr>
    <tr>
      <th>n.cluster</th>
      <td><p>Number of clusters to calculate.</p></td>
    </tr>
    <tr>
      <th>plot</th>
      <td><p>Should a plot be produced?</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p><code>type</code> determines how the data are split i.e.
conditioned, and then plotted. The default is will produce a
single plot using the entire data. Type can be one of the
built-in types as detailed in <code>cutData</code> e.g.
&#8220;season&#8221;, &#8220;year&#8221;, &#8220;weekday&#8221; and so on. For
example, <code>type = "season"</code> will produce four plots --- one
for each season. Note that the cluster calculations are
separately made of each level of "type".</p></td>
    </tr>
    <tr>
      <th>cols</th>
      <td><p>Colours to be used for plotting. Options include
&#8220;default&#8221;, &#8220;increment&#8221;, &#8220;heat&#8221;,
&#8220;jet&#8221; and <code>RColorBrewer</code> colours --- see the
<code>openair</code> <code>openColours</code> function for more details. For
user defined the user can supply a list of colour names
recognised by R (type <code><a href='https://rdrr.io/r/grDevices/colors.html'>colours()</a></code> to see the full list). An
example would be <code>cols = c("yellow", "green", "blue")</code></p></td>
    </tr>
    <tr>
      <th>split.after</th>
      <td><p>For <code>type</code> other than &#8220;default&#8221;
e.g. &#8220;season&#8221;, the trajectories can either be calculated
for each level of <code>type</code> independently or extracted after
the cluster calculations have been applied to the whole data
set.</p></td>
    </tr>
    <tr>
      <th>map.fill</th>
      <td><p>Should the base map be a filled polygon? Default
is to fill countries.</p></td>
    </tr>
    <tr>
      <th>map.cols</th>
      <td><p>If <code>map.fill = TRUE</code> <code>map.cols</code> controls
the fill colour. Examples include <code>map.fill = "grey40"</code> and
<code>map.fill = openColours("default", 10)</code>. The latter colours
the countries and can help differentiate them.</p></td>
    </tr>
    <tr>
      <th>map.alpha</th>
      <td><p>The transpency level of the filled map which
takes values from 0 (full transparency) to 1 (full opacity).
Setting it below 1 can help view trajectories, trajectory
surfaces etc. <em>and</em> a filled base map.</p></td>
    </tr>
    <tr>
      <th>projection</th>
      <td><p>The map projection to be used. Different map
projections are possible through the <code>mapproj</code> package.
See<code>?mapproject</code> for extensive details and information on
setting other parameters and orientation (see below).</p></td>
    </tr>
    <tr>
      <th>parameters</th>
      <td><p>From the <code>mapproj</code> package. Optional
numeric vector of parameters for use with the projection
argument. This argument is optional only in the sense that
certain projections do not require additional parameters. If a
projection does require additional parameters, these must be
given in the parameters argument.</p></td>
    </tr>
    <tr>
      <th>orientation</th>
      <td><p>From the <code>mapproj</code> package. An optional
vector c(latitude,longitude,rotation) which describes where the
"North Pole" should be when computing the projection. Normally
this is c(90,0), which is appropriate for cylindrical and conic
projections. For a planar projection, you should set it to the
desired point of tangency. The third value is a clockwise
rotation (in degrees), which defaults to the midrange of the
longitude coordinates in the map.</p></td>
    </tr>
    <tr>
      <th>by.type</th>
      <td><p>The percentage of the total number of trajectories
is given for all data by default. Setting <code>by.type = TRUE</code>
will make each panel add up to 100.</p></td>
    </tr>
    <tr>
      <th>origin</th>
      <td><p>If <code>TRUE</code> a filled circle dot is shown to mark the
receptor point.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other graphical parameters passed onto
<code>lattice:levelplot</code> and <code>cutData</code>. Similarly, common
axis and title labelling options (such as <code>xlab</code>,
<code>ylab</code>, <code>main</code>) are passed to <code>levelplot</code> via
<code>quickText</code> to handle routine formatting.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns a list with two data components. The first
  (<code>data</code>) contains the orginal data with the cluster
  identified. The second (<code>results</code>) contains the data used
  to plot the clustered trajectories.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Two main methods are available to cluster the back trajectories
using two different calculations of the distance matrix. The
default is to use the standard Euclidian distance between each
pair of trajectories. Also available is an angle-based distance
matrix based on Sirois and Bottenheim (1995). The latter method is
useful when the interest is the direction of the trajectories in
clustering.</p>
<p>The distance matrix calculations are made in C++ for speed. For
data sets of up to 1 year both methods should be relatively fast,
although the <code>method = "Angle"</code> does tend to take much longer
to calculate. Further details of these methods are given in the
openair manual.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Sirois, A. and Bottenheim, J.W., 1995. Use of backward
trajectories to interpret the 5-year record of PAN and O3 ambient
air concentrations at Kejimkujik National Park, Nova
Scotia. Journal of Geophysical Research, 100: 2867-2881.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='importTraj.html'>importTraj</a></code>, <code><a href='trajPlot.html'>trajPlot</a></code>,
  <code><a href='trajLevel.html'>trajLevel</a></code></p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>David Carslaw</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'><span class='co'>## import trajectories</span></span>
<span class='r-in'><span class='va'>traj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='importTraj.html'>importTraj</a></span><span class='op'>(</span>site <span class='op'>=</span> <span class='st'>"london"</span>, year <span class='op'>=</span> <span class='fl'>2009</span><span class='op'>)</span></span>
<span class='r-in'><span class='co'>## calculate clusters</span></span>
<span class='r-in'><span class='va'>clust</span> <span class='op'>&lt;-</span> <span class='fu'>trajCluster</span><span class='op'>(</span><span class='va'>traj</span>, n.cluster <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>clust</span><span class='op'>$</span><span class='va'>data</span><span class='op'>)</span> <span class='co'>## note new variable 'cluster'</span></span>
<span class='r-in'><span class='co'>## use different distance matrix calculation, and calculate by season</span></span>
<span class='r-in'><span class='va'>traj</span> <span class='op'>&lt;-</span> <span class='fu'>trajCluster</span><span class='op'>(</span><span class='va'>traj</span>, method <span class='op'>=</span> <span class='st'>"Angle"</span>, type <span class='op'>=</span> <span class='st'>"season"</span>, n.cluster <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span></span>
<span class='r-in'><span class='op'>}</span></span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Carslaw, Karl Ropkins.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


