<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Linear relations between pollutants — linearRelation • openair</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Linear relations between pollutants — linearRelation" />
<meta property="og:description" content="This function considers linear relationships between two
pollutants. The relationships are calculated on different times
bases using a linear model.  The slope and 95
in slope relationships by time unit are plotted in many ways. The
function is particularly useful when considering whether
relationships are consistent with emissions inventories." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">openair</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.8-6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/davidcarslaw/openair">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Linear relations between pollutants</h1>
    <small class="dont-index">Source: <a href='https://github.com/davidcarslaw/openair/blob/master/R/linearRelation.R'><code>R/linearRelation.R</code></a></small>
    <div class="hidden name"><code>linearRelation.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function considers linear relationships between two
pollutants. The relationships are calculated on different times
bases using a linear model.  The slope and 95<!-- % confidence interval -->
in slope relationships by time unit are plotted in many ways. The
function is particularly useful when considering whether
relationships are consistent with emissions inventories.</p>
    </div>

    <pre class="usage"><span class='fu'>linearRelation</span><span class='op'>(</span>
  <span class='va'>mydata</span>,
  x <span class='op'>=</span> <span class='st'>"nox"</span>,
  y <span class='op'>=</span> <span class='st'>"no2"</span>,
  period <span class='op'>=</span> <span class='st'>"month"</span>,
  condition <span class='op'>=</span> <span class='cn'>FALSE</span>,
  n <span class='op'>=</span> <span class='fl'>20</span>,
  rsq.thresh <span class='op'>=</span> <span class='fl'>0</span>,
  ylab <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"slope from "</span>, <span class='va'>y</span>, <span class='st'>" = m."</span>, <span class='va'>x</span>, <span class='st'>" + c"</span><span class='op'>)</span>,
  auto.text <span class='op'>=</span> <span class='cn'>TRUE</span>,
  cols <span class='op'>=</span> <span class='st'>"grey30"</span>,
  date.breaks <span class='op'>=</span> <span class='fl'>5</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>mydata</th>
      <td><p>A data frame minimally containing <code>date</code> and
two pollutants.</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>First pollutant that when plotted would appear on the
x-axis of a relationship e.g. <code>x = "nox"</code>.</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>Second pollutant that when plotted would appear on the
y-axis of a relationship e.g. <code>y = "pm10"</code>.</p></td>
    </tr>
    <tr>
      <th>period</th>
      <td><p>A range of different time periods can be
analysed. The default is <code>month</code> but can be <code>year</code>
and <code>week</code>. For increased flexibility an integer can be
used e.g. for 3-month values <code>period = "3 month"</code>. Other
cases include <code>"hour"</code> will show the diurnal relationship
between <code>x</code> and <code>y</code> and &#8220;weekday&#8221; the day of
the week relationship between <code>x</code> and
<code>y</code>. &#8220;day.hour&#8221; will plot the relationship by
weekday and hour of the day.</p></td>
    </tr>
    <tr>
      <th>condition</th>
      <td><p>For <code>period = "hour"</code>, <code>period = "day"</code>
and <code>period = "day.hour"</code>, setting <code>condition =
TRUE</code> will plot the relationships split by year. This is
useful for seeing how the relationships may be changing over
time.</p></td>
    </tr>
    <tr>
      <th>n</th>
      <td><p>The minimum number of points to be sent to the linear
model.  Because there may only be a few points e.g. hours
where two pollutants are available over one week, <code>n</code> can
be set to ensure that at least <code>n</code> points are sent to the
linear model. If a period has hours &lt; <code>n</code> that period
will be ignored.</p></td>
    </tr>
    <tr>
      <th>rsq.thresh</th>
      <td><p>The minimum correlation coefficient (R2)
allowed. If the relationship between <code>x</code> and <code>y</code> is
not very good for a particular period, setting
<code>rsq.thresh</code> can help to remove those periods where the
relationship is not strong. Any R2 values below
<code>rsq.thresh</code> will not be plotted.</p></td>
    </tr>
    <tr>
      <th>ylab</th>
      <td><p>y-axis title, specified by the user.</p></td>
    </tr>
    <tr>
      <th>auto.text</th>
      <td><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If
<code>TRUE</code> titles and axis labels will automatically try and
format pollutant names and units properly e.g.  by
subscripting the &#8216;2&#8217; in NO2.</p></td>
    </tr>
    <tr>
      <th>cols</th>
      <td><p>Colour for the points and uncertainty intervals.</p></td>
    </tr>
    <tr>
      <th>date.breaks</th>
      <td><p>Number of major x-axis intervals to use. The
function will try and choose a sensible number of dates/times
as well as formatting the date/time appropriately to the range
being considered.  This does not always work as desired
automatically. The user can therefore increase or decrease the
number of intervals by adjusting the value of
<code>date.breaks</code> up or down.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other graphical parameters. A useful one to remove the
strip with the date range on at the top of the plot is to set
<code>strip = FALSE</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>As well as generating the plot itself,
    <code>linearRelation</code> also returns an object of class
    ``openair''. The object includes three main components:
    <code>call</code>, the command used to generate the plot;
    <code>data</code>, the data frame of summarised information used to
    make the plot; and <code>plot</code>, the plot itself. If retained,
    e.g. using <code>output &lt;- linearRelation(mydata, "nox",
    "no2")</code>, this output can be used to recover the data,
    reproduce or rework the original plot or undertake further
    analysis.</p>
<p>An openair output can be manipulated using a number of generic operations,
  including <code>print</code>, <code>plot</code> and <code>summary</code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The relationships between pollutants can yield some very useful
information about source emissions and how they change. A
scatterPlot between two pollutants is the usual way to investigate
the relationship. A linear regression is useful to test the
strength of the relationship. However, considerably more
information can be gleaned by considering different time periods,
such as how the relationship between two pollutants vary over
time, by day of the week, diurnally and so on. The
<code>linearRelation</code> function does just that - it fits a linear
relationship between two pollutants over a wide range of time
periods determined by <code>period</code>.</p>
<p><code>linearRelation</code> function is particularly useful if
background concentrations are first removed from roadside
concentrations, as the increment will relate more directly with
changes in emissions. In this respect, using <code>linearRelation</code>
can provide valuable information on how emissions may have changed
over time, by hour of the day etc. Using the function in this way
will require users to do some basic manipulation with their data
first.</p>
<p>If a data frame is supplied that contains <code>nox</code>, <code>no2</code>
and <code>o3</code>, the <code>y</code> can be chosen as <code>y = "ox"</code>. In
function will therefore consider total oxidant slope (sum of NO2 +
O3), which can provide valuable information on likely vehicle
primary NO emissions. Note, however, that most roadside sites do
not have ozone measurements and <code><a href='calcFno2.html'>calcFno2</a></code> is the
alternative.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='calcFno2.html'>calcFno2</a></code></p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>David Carslaw</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='r-in'></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># monthly relationship between NOx and SO2 - note rapid fall in</span></span>
<span class='r-in'><span class='co'># ratio at the beginning of the series</span></span>
<span class='r-in'><span class='fu'>linearRelation</span><span class='op'>(</span><span class='va'>mydata</span>, x <span class='op'>=</span> <span class='st'>"nox"</span>, y <span class='op'>=</span> <span class='st'>"so2"</span><span class='op'>)</span></span>
<span class='r-plt img'><img src='linearRelation-1.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='co'># monthly relationship between NOx and SO2 - note rapid fall in</span></span>
<span class='r-in'><span class='co'># ratio at the beginning of the series</span></span>
<span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='fu'>linearRelation</span><span class='op'>(</span><span class='va'>mydata</span>, x <span class='op'>=</span> <span class='st'>"nox"</span>, y <span class='op'>=</span> <span class='st'>"ox"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># diurnal oxidant slope by year # clear change in magnitude</span></span>
<span class='r-in'><span class='co'># starting 2003, but the diurnal profile has also changed: the</span></span>
<span class='r-in'><span class='co'># morning and evening peak hours are more important, presumably</span></span>
<span class='r-in'><span class='co'># due to change in certain vehicle types</span></span>
<span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='fu'>linearRelation</span><span class='op'>(</span><span class='va'>mydata</span>, x <span class='op'>=</span> <span class='st'>"nox"</span>, y <span class='op'>=</span> <span class='st'>"ox"</span>, period <span class='op'>=</span> <span class='st'>"hour"</span>, condition <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># PM2.5/PM10 ratio, but only plot where monthly R2 &gt;= 0.8</span></span>
<span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='fu'>linearRelation</span><span class='op'>(</span><span class='va'>mydata</span>, x <span class='op'>=</span> <span class='st'>"pm10"</span>, y <span class='op'>=</span> <span class='st'>"pm25"</span>, rsq.thresh <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'></span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Carslaw, Karl Ropkins.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


