<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Function to plot percentiles by wind direction — percentileRose • openair</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Function to plot percentiles by wind direction — percentileRose" />
<meta property="og:description" content="percentileRose plots percentiles by wind direction with
flexible conditioning. The plot can display mutiple percentile
lines or filled areas." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">openair</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.8-6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/davidcarslaw/openair">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Function to plot percentiles by wind direction</h1>
    <small class="dont-index">Source: <a href='https://github.com/davidcarslaw/openair/blob/master/R/percentileRose.R'><code>R/percentileRose.R</code></a></small>
    <div class="hidden name"><code>percentileRose.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>percentileRose</code> plots percentiles by wind direction with
flexible conditioning. The plot can display mutiple percentile
lines or filled areas.</p>
    </div>

    <pre class="usage"><span class='fu'>percentileRose</span><span class='op'>(</span>
  <span class='va'>mydata</span>,
  pollutant <span class='op'>=</span> <span class='st'>"nox"</span>,
  wd <span class='op'>=</span> <span class='st'>"wd"</span>,
  type <span class='op'>=</span> <span class='st'>"default"</span>,
  percentile <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>25</span>, <span class='fl'>50</span>, <span class='fl'>75</span>, <span class='fl'>90</span>, <span class='fl'>95</span><span class='op'>)</span>,
  smooth <span class='op'>=</span> <span class='cn'>FALSE</span>,
  method <span class='op'>=</span> <span class='st'>"default"</span>,
  cols <span class='op'>=</span> <span class='st'>"default"</span>,
  angle <span class='op'>=</span> <span class='fl'>10</span>,
  mean <span class='op'>=</span> <span class='cn'>TRUE</span>,
  mean.lty <span class='op'>=</span> <span class='fl'>1</span>,
  mean.lwd <span class='op'>=</span> <span class='fl'>3</span>,
  mean.col <span class='op'>=</span> <span class='st'>"grey"</span>,
  fill <span class='op'>=</span> <span class='cn'>TRUE</span>,
  intervals <span class='op'>=</span> <span class='cn'>NULL</span>,
  angle.scale <span class='op'>=</span> <span class='fl'>45</span>,
  auto.text <span class='op'>=</span> <span class='cn'>TRUE</span>,
  key.header <span class='op'>=</span> <span class='cn'>NULL</span>,
  key.footer <span class='op'>=</span> <span class='st'>"percentile"</span>,
  key.position <span class='op'>=</span> <span class='st'>"bottom"</span>,
  key <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>mydata</th>
      <td><p>A data frame minimally containing <code>wd</code> and a
numeric field to plot --- <code>pollutant</code>.</p></td>
    </tr>
    <tr>
      <th>pollutant</th>
      <td><p>Mandatory. A pollutant name corresponding to a
variable in a data frame should be supplied e.g. <code>pollutant
= "nox"</code>. More than one pollutant can be supplied e.g.
<code>pollutant = c("no2", "o3")</code> provided there is only one
<code>type</code>.</p></td>
    </tr>
    <tr>
      <th>wd</th>
      <td><p>Name of the wind direction field.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p><code>type</code> determines how the data are split i.e.
  conditioned, and then plotted. The default is will produce a
  single plot using the entire data. Type can be one of the
  built-in types as detailed in <code>cutData</code> e.g.
  &#8220;season&#8221;, &#8220;year&#8221;, &#8220;weekday&#8221; and so on. For
  example, <code>type = "season"</code> will produce four plots --- one
  for each season.</p>
<p>It is also possible to choose <code>type</code> as another variable in
  the data frame. If that variable is numeric, then the data will
  be split into four quantiles (if possible) and labelled
  accordingly. If type is an existing character or factor
  variable, then those categories/levels will be used directly.
  This offers great flexibility for understanding the variation of
  different variables and how they depend on one another.</p>
<p>Type can be up length two e.g. <code>type = c("season",
  "weekday")</code> will produce a 2x2 plot split by season and day of
  the week. Note, when two types are provided the first forms the
  columns and the second the rows.</p></td>
    </tr>
    <tr>
      <th>percentile</th>
      <td><p>The percentile value(s) to plot. Must be between
0--100. If <code>percentile = NA</code> then only a mean line will be
shown.</p></td>
    </tr>
    <tr>
      <th>smooth</th>
      <td><p>Should the wind direction data be smoothed using a
cyclic spline?</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>When <code>method = "default"</code> the supplied
percentiles by wind direction are calculated. When <code>method
= "cpf"</code> the conditional probability function (CPF) is plotted
and a single (usually high) percentile level is supplied. The
CPF is defined as CPF = my/ny, where my is the number of samples
in the wind sector y with mixing ratios greater than the
<em>overall</em> percentile concentration, and ny is the total
number of samples in the same wind sector (see Ashbaugh et al.,
1985).</p></td>
    </tr>
    <tr>
      <th>cols</th>
      <td><p>Colours to be used for plotting. Options include
&#8220;default&#8221;, &#8220;increment&#8221;, &#8220;heat&#8221;,
&#8220;jet&#8221; and <code>RColorBrewer</code> colours --- see the
<code>openair</code> <code>openColours</code> function for more details. For
user defined the user can supply a list of colour names
recognised by R (type <code><a href='https://rdrr.io/r/grDevices/colors.html'>colours()</a></code> to see the full list). An
example would be <code>cols = c("yellow", "green", "blue")</code></p></td>
    </tr>
    <tr>
      <th>angle</th>
      <td><p>Default angle of &#8220;spokes&#8221; is when <code>smooth = FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>mean</th>
      <td><p>Show the mean by wind direction as a line?</p></td>
    </tr>
    <tr>
      <th>mean.lty</th>
      <td><p>Line type for mean line.</p></td>
    </tr>
    <tr>
      <th>mean.lwd</th>
      <td><p>Line width for mean line.</p></td>
    </tr>
    <tr>
      <th>mean.col</th>
      <td><p>Line colour for mean line.</p></td>
    </tr>
    <tr>
      <th>fill</th>
      <td><p>Should the percentile intervals be filled (default) or
should lines be drawn (<code>fill = FALSE</code>).</p></td>
    </tr>
    <tr>
      <th>intervals</th>
      <td><p>User-supplied intervals for the scale e.g.
<code>intervals = c(0, 10, 30, 50)</code></p></td>
    </tr>
    <tr>
      <th>angle.scale</th>
      <td><p>The pollutant scale is by default shown at a 45
degree angle. Sometimes the placement of the scale may interfere
with an interesting feature. The user can therefore set
<code>angle.scale</code> to another value (between 0 and 360 degrees)
to mitigate such problems. For example <code>angle.scale = 315</code>
will draw the scale heading in a NW direction.</p></td>
    </tr>
    <tr>
      <th>auto.text</th>
      <td><p>Either <code>TRUE</code> (default) or <code>FALSE</code>. If
<code>TRUE</code> titles and axis labels will automatically try and
format pollutant names and units properly e.g.  by subscripting
the &#8216;2&#8217; in NO2.</p></td>
    </tr>
    <tr>
      <th>key.header</th>
      <td><p>Adds additional text/labels to the scale key.
For example, passing options <code>key.header = "header",
key.footer = "footer"</code> adds addition text above and below the
scale key. These arguments are passed to <code>drawOpenKey</code> via
<code>quickText</code>, applying the <code>auto.text</code> argument, to
handle formatting.</p></td>
    </tr>
    <tr>
      <th>key.footer</th>
      <td><p><code>key.header</code>.</p></td>
    </tr>
    <tr>
      <th>key.position</th>
      <td><p>Location where the scale key is to plotted.
Allowed arguments currently include <code>"top"</code>,
<code>"right"</code>, <code>"bottom"</code> and <code>"left"</code>.</p></td>
    </tr>
    <tr>
      <th>key</th>
      <td><p>Fine control of the scale key via <code>drawOpenKey</code>.
See <code>drawOpenKey</code> for further details.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other graphical parameters are passed onto
<code>cutData</code> and <code>lattice:xyplot</code>. For example,
<code>percentileRose</code> passes the option <code>hemisphere =
"southern"</code> on to <code>cutData</code> to provide southern (rather
than default northern) hemisphere handling of <code>type =
"season"</code>. Similarly, common graphical arguments, such as
<code>xlim</code> and <code>ylim</code> for plotting ranges and <code>lwd</code>
for line thickness when using <code>fill = FALSE</code>, are passed on
<code>xyplot</code>, although some local modifications may be applied
by openair. For example, axis and title labelling options (such
as <code>xlab</code>, <code>ylab</code> and <code>main</code>) are passed to
<code>xyplot</code> via <code>quickText</code> to handle routine formatting.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>As well as generating the plot itself,
  <code>percentileRose</code> also returns an object of class
  &#8220;openair&#8221;. The object includes three main components:
  <code>call</code>, the command used to generate the plot; <code>data</code>,
  the data frame of summarised information used to make the plot;
  and <code>plot</code>, the plot itself. If retained, e.g. using
  <code>output &lt;- percentileRose(mydata, "nox")</code>, this output can
  be used to recover the data, reproduce or rework the original
  plot or undertake further analysis.</p>
<p>An openair output can be manipulated using a number of generic
  operations, including <code>print</code>, <code>plot</code> and
  <code>summary</code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>percentileRose</code> calculates percentile levels of a pollutant
and plots them by wind direction. One or more percentile levels
can be calculated and these are displayed as either filled areas
or as lines.</p>
<p>The wind directions are rounded to the nearest 10 degrees,
consistent with surface data from the UK Met Office before a
smooth is fitted. The levels by wind direction are optionally
calculated using a cyclic smooth cubic spline using the option
<code>smooth</code>. If <code>smooth = FALSE</code> then the data are shown in
10 degree sectors.</p>
<p>The <code>percentileRose</code> function compliments other similar
functions including <code><a href='windRose.html'>windRose</a></code>,
<code><a href='windRose.html'>pollutionRose</a></code>, <code><a href='polarFreq.html'>polarFreq</a></code> or
<code><a href='polarPlot.html'>polarPlot</a></code>. It is most useful for showing the
distribution of concentrations by wind direction and often can
reveal different sources e.g. those that only affect high
percentile concentrations such as a chimney stack.</p>
<p>Similar to other functions, flexible conditioning is available
through the <code>type</code> option. It is easy for example to consider
multiple percentile values for a pollutant by season, year and so
on. See examples below.</p>
<p><code>percentileRose</code> also offers great flexibility with the scale
used and the user has fine control over both the range, interval
and colour.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Ashbaugh, L.L., Malm, W.C., Sadeh, W.Z., 1985. A
residence time probability analysis of sulfur concentrations at
ground canyon national park. Atmospheric Environment 19 (8),
1263-1270.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>See Also as <code><a href='windRose.html'>windRose</a></code>,
  <code><a href='windRose.html'>pollutionRose</a></code>, <code><a href='polarFreq.html'>polarFreq</a></code>,
  <code><a href='polarPlot.html'>polarPlot</a></code></p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>David Carslaw</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='r-in'></span>
<span class='r-in'><span class='co'># basic percentile plot</span></span>
<span class='r-in'><span class='fu'>percentileRose</span><span class='op'>(</span><span class='va'>mydata</span>, pollutant <span class='op'>=</span> <span class='st'>"o3"</span><span class='op'>)</span></span>
<span class='r-plt img'><img src='percentileRose-1.png' alt='' width='700' height='433' /></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># 50/95th percentiles of ozone, with different colours</span></span>
<span class='r-in'><span class='fu'>percentileRose</span><span class='op'>(</span><span class='va'>mydata</span>, pollutant <span class='op'>=</span> <span class='st'>"o3"</span>, percentile <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>50</span>, <span class='fl'>95</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='st'>"brewer1"</span><span class='op'>)</span></span>
<span class='r-plt img'><img src='percentileRose-2.png' alt='' width='700' height='433' /></span>
<span class='r-in'></span>
<span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'><span class='co'># percentiles of ozone by year, with different colours</span></span>
<span class='r-in'><span class='fu'>percentileRose</span><span class='op'>(</span><span class='va'>mydata</span>, type <span class='op'>=</span> <span class='st'>"year"</span>, pollutant <span class='op'>=</span> <span class='st'>"o3"</span>, col <span class='op'>=</span> <span class='st'>"brewer1"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># percentile concentrations by season and day/nighttime..</span></span>
<span class='r-in'><span class='fu'>percentileRose</span><span class='op'>(</span><span class='va'>mydata</span>, type <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"season"</span>, <span class='st'>"daylight"</span><span class='op'>)</span>, pollutant <span class='op'>=</span> <span class='st'>"o3"</span>, col <span class='op'>=</span> <span class='st'>"brewer1"</span><span class='op'>)</span></span>
<span class='r-in'><span class='op'>}</span></span>
<span class='r-in'></span>
<span class='r-in'></span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Carslaw, Karl Ropkins.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


